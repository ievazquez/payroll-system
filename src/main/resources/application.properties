# Application Configuration
spring.application.name=PayrollSystem
##Console
#spring.main.web-application-type=none


# Server Configuration
server.port=${SERVER_PORT:8080}

# PostgreSQL Configuration
# En Docker usa variables de entorno, en local usa valores por defecto
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/payroll_db}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:postgres}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:postgres}
spring.datasource.driver-class-name=org.postgresql.Driver

# --- DATABASE CONNECTION POOL (El Ajuste Obligatorio) ---
# Si tienes 10 hilos de RabbitMQ + Tráfico Web, necesitas suficientes conexiones.
# Regla de dedo: max-concurrency + 5 buffer para la API Web
spring.datasource.hikari.maximum-pool-size=15

# Tiempo de espera antes de fallar si no hay conexión disponible (30 seg)
spring.datasource.hikari.connection-timeout=30000

# JPA/Hibernate Configuration
# none = No crear tablas automáticamente, usar schema.sql
# update = Hibernate crea/actualiza tablas automáticamente
spring.jpa.hibernate.ddl-auto=${SPRING_JPA_HIBERNATE_DDL_AUTO:none}
spring.jpa.show-sql=${SPRING_JPA_SHOW_SQL:true}
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true

# JDBC Batching Configuration - Mejora el rendimiento en operaciones masivas
spring.jpa.properties.hibernate.jdbc.batch_size=100
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.batch_versioned_data=true

# SQL Initialization - Ejecutar schema.sql y data.sql
spring.sql.init.mode=${SPRING_SQL_INIT_MODE:always}
spring.sql.init.schema-locations=classpath:schema.sql
spring.sql.init.data-locations=classpath:data.sql
spring.sql.init.continue-on-error=false

# RabbitMQ Configuration
# En Docker usa variables de entorno, en local usa valores por defecto
spring.rabbitmq.host=${SPRING_RABBITMQ_HOST:localhost}
spring.rabbitmq.port=${SPRING_RABBITMQ_PORT:5672}
spring.rabbitmq.username=${SPRING_RABBITMQ_USERNAME:guest}
spring.rabbitmq.password=${SPRING_RABBITMQ_PASSWORD:guest}

# --- RABBITMQ PARALLELISM ---
# Inicia con 5 hilos consumidores (Workers) simultáneos
spring.rabbitmq.listener.simple.concurrency=5

# Puede subir hasta 10 hilos si la cola está muy llena
spring.rabbitmq.listener.simple.max-concurrency=10

# CRÍTICO: Cada trabajador toma SOLO 1 mensaje a la vez.
# Esto evita que un worker rápido acapare todo el trabajo mientras otros miran.
spring.rabbitmq.listener.simple.prefetch=1
